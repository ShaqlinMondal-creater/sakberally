# ===============================
# Canonical + Security .htaccess
# ===============================

# 1) Disable directory browsing
Options -Indexes

# 2) Security - Block sensitive files
<FilesMatch "^(composer\.(json|lock)|package\.json|yarn\.lock|\.env|\.gitignore|\.htpasswd|.*\.sql)$">
  Require all denied
</FilesMatch>

# 3) Force HTTPS + remove www (keep path & query)
#    Also strip /index or /index.php to root
<IfModule mod_rewrite.c>
  RewriteEngine On

  # --- Canonical host + HTTPS ---
  # If HTTP or host starts with www., redirect to https://sakberally.com{REQUEST_URI}
  RewriteCond %{HTTPS} !=on [OR]
  RewriteCond %{HTTP_HOST} ^www\. [NC]
  RewriteRule ^ https://sakberally.com%{REQUEST_URI} [R=301,L,NE]

  # --- Remove index filenames ---
  RewriteRule ^index(\.php)?$ / [R=301,L]

  # --- Skip rewrite rules for /apis and /admin (they stay as-is) ---
  RewriteRule ^(apis|admin)(/.*)?$ - [L]

  # --- Allow direct access to specific pages ---
  RewriteRule ^(about|contact_us|brands|inquiry_form)$ $1.php [L]

  # --- Allow specific routed pages ---
  RewriteRule ^products$ products.php [L]
  RewriteRule ^product_detail$ product_detail.php [L]

  # --- Front controller for everything else (if not a real file/dir) ---
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^ index.php [L,QSA]
</IfModule>

# 4) Compression
<IfModule mod_deflate.c>
  SetOutputFilter DEFLATE
  AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css application/javascript
</IfModule>

# 5) Caching (static assets)
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
</IfModule>

# 6) Extra protection for .env, etc.
<Files .env>
  Order allow,deny
  Deny from all
</Files>

# 7) (Optional) HSTS after you're sure HTTPS works everywhere
# Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
